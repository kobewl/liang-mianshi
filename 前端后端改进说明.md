# 前端后端改进说明

## 后端改进（已完成）

### 1. ✅ 实现Token登录系统
- 创建了 `JwtUtils.java` 工具类，实现JWT Token的生成、解析和验证
- Token有效期设置为7天
- Token包含用户ID、账号、角色信息

### 2. ✅ 添加认证拦截器
- 创建了 `AuthInterceptor.java` 拦截器
- 拦截所有需要认证的请求
- 自动验证Token并将用户信息存入请求属性
- 排除登录、注册等不需要认证的接口

### 3. ✅ 配置Web拦截器
- 创建了 `WebConfig.java` 配置类
- 配置拦截器规则
- 排除的路径：
  - `/api/user/login` - 登录接口
  - `/api/user` (POST) - 注册接口
  - `/doc.html` - API文档
  - Swagger相关路径

### 4. ✅ 修改登录逻辑
- 在 `UserServiceImpl` 中添加Token生成逻辑
- 登录成功后返回Token
- `UserLoginVO` 包含用户信息和Token

### 5. ✅ 添加用户认证接口
- `GET /api/user/current` - 获取当前登录用户信息
- `POST /api/user/logout` - 用户登出接口（客户端删除Token即可）

### 6. ✅ 统一API路径
- 将UserController的映射路径改为 `/api/user`
- 保持与其他Controller一致的风格

## 前端改进（已完成）

### 1. ✅ 修复API基础路径
- 将axios的baseURL从 `http://localhost:8184/api` 改为 `http://localhost:8184`
- 统一所有API接口路径，需要认证的接口都加上 `/api` 前缀
- 登录和注册接口路径：`/api/user/login` 和 `/api/user`

### 2. ✅ 修复响应code检查
- 后端返回的成功code是200，不是0
- 修改Login.vue、Register.vue和store/index.js中的code检查逻辑
- 统一使用 `response.code === 200` 判断成功

### 3. ✅ 修复登录跳转
- 登录成功后跳转到主页 `/` 而不是 `/question-banks`
- 添加登录成功提示信息

### 4. ✅ 改进错误处理
- 在catch块中获取后端返回的错误信息
- 使用 `error.response?.data?.message` 获取详细错误
- 提供更友好的错误提示

### 5. ✅ 修复注册逻辑
- 注册时去掉 `checkPassword` 字段（后端不需要）
- 使用解构语法 `const { checkPassword, ...registerData } = registerForm`

### 6. ✅ Token自动携带
- request.js中的请求拦截器会自动从localStorage读取token
- 自动在请求头中添加 `Authorization: Bearer ${token}`
- 401错误时自动清除token并跳转到登录页

## 需要进一步改进的问题

### 前端UI问题（待解决）

1. **✅ 页面填充问题已解决**
   - Login.vue使用了 `height: 100vh`，已经填充整个屏幕
   - Home.vue使用了 `min-height: 100vh`，已经填充整个屏幕
   - App.vue中设置了全局样式确保填充

2. **操作成功提示图标**
   - 当前使用ant-design-vue的message组件
   - `message.success()` 默认会显示绿色的对勾图标
   - 如果显示X号，可能是message类型用错了（error而不是success）
   - 已统一使用 `message.success()` 显示成功信息

## 测试步骤

### 1. 启动后端
```bash
cd backend
mvn spring-boot:run
```

### 2. 启动前端
```bash
cd frontend
npm install
npm run dev
```

### 3. 测试注册
1. 访问 http://localhost:5173/register
2. 填写注册信息（账号至少4位，密码至少6位）
3. 点击注册按钮
4. 应该显示"注册成功！"并跳转到登录页

### 4. 测试登录
1. 访问 http://localhost:5173/login
2. 输入注册的账号和密码（或使用wangliang/123456）
3. 点击登录按钮
4. 应该显示"登录成功！"并跳转到主页
5. Token会自动保存到localStorage

### 5. 测试认证
1. 登录后访问任何管理页面（用户管理、题目管理、题库管理）
2. 应该能正常访问，所有请求都会自动携带Token
3. 打开浏览器开发者工具 -> Application -> Local Storage
4. 应该能看到保存的token和userInfo

### 6. 测试登出
1. 点击右上角用户菜单
2. 点击"退出登录"
3. 应该显示"已退出登录"并跳转到登录页
4. Token应该从localStorage中清除

### 7. 测试Token过期
1. 清除localStorage中的token
2. 尝试访问需要认证的页面
3. 应该自动跳转到登录页

## 技术要点

### JWT Token格式
```
Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOjEsInVzZXJBY2NvdW50Ijoid2FuZ2xpYW5nIiwidXNlclJvbGUiOiJ1c2VyIiwic3ViIjoid2FuZ2xpYW5nIiwiaWF0IjoxNzM0MTY4MDAwLCJleHAiOjE3MzQ3NzI4MDB9.xxxxx
```

### Token包含信息
- userId: 用户ID
- userAccount: 用户账号
- userRole: 用户角色
- exp: 过期时间（7天后）

### 前端Token存储
```javascript
// 保存Token
localStorage.setItem('token', token);

// 读取Token
const token = localStorage.getItem('token');

// 清除Token
localStorage.removeItem('token');
```

### 后端Token验证
```java
// 从请求头获取Token
String token = request.getHeader("Authorization");

// 验证Token
if (JwtUtils.validateToken(token)) {
    Long userId = JwtUtils.getUserIdFromToken(token);
    // ... 处理业务逻辑
}
```

## 安全性说明

1. Token使用HS256算法签名
2. Token有效期7天
3. 密码目前明文存储（生产环境需要加密）
4. Token包含用户敏感信息，使用HTTPS传输
5. 前端Token存储在localStorage（可考虑使用httpOnly cookie）

## 后续优化建议

1. ✅ 密码加密存储（使用BCrypt）
2. Token刷新机制（refresh token）
3. Token黑名单（实现强制登出）
4. Redis存储Token（实现分布式session）
5. 限流和防重放攻击
6. CORS配置优化
7. 前端路由守卫完善
8. 错误码统一管理

